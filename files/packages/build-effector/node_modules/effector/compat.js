'use strict';function e(e,r){void 0===r&&(r='combine');var t=r+'(',n='',a=0;for(var o in e){var i=e[o];if(null!=i&&(t+=n,t+=p(i)?i.compositeName.fullName:i.toString()),25===(a+=1))break;n=', '}return t+')'}function r(e,r){var t,n,a,o=e;return r?(a=r.compositeName,0===e.length?(t=a.path,n=a.fullName):(t=a.path.concat([e]),n=0===a.fullName.length?e:a.fullName+'/'+e)):(t=0===e.length?[]:[e],n=e),{shortName:o,fullName:n,path:t}}function t(e){for(var r=e.node,t=void 0===r?[]:r,n=e.parent,a=e.child,o=void 0===a?e.to||e.target:a,i=e.scope,u=void 0===i?{}:i,f=e.meta,s=void 0===f?{}:f,c=e.family,l=void 0===c?{type:'regular'}:c,p=re(void 0===n?e.from||e.source:n),d=re(l.links),m=re(l.owners),v=[],h={},g=0;g<t.length;g++){var y=t[g];y&&(v.push(y),te(y,h))}for(var b={seq:v,next:re(o),meta:s,scope:u,family:{type:l.type||'crosslink',links:d,owners:m},reg:h},k=0;k<d.length;k++)q(d[k]).push(b);for(var w=0;w<m.length;w++)N(m[w]).push(b);for(var x=0;x<p.length;x++)p[x].next.push(b);return b}function n(e,r){var o=function e(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return e.create(r,n,n)};o.graphite=t({meta:Ce('event',o,r,e)}),o.create=function(e){return he(o,e),e},o.watch=R(Ee,o),o.map=function(e){var r,t;k(e)&&(r=e,t=e.name,e=e.fn);var a=n(T(o,t),r);return ze(o,a,'map',e),a},o.filter=function(e){return w(e)?(console.error('.filter(fn) is deprecated, use .filterMap instead'),a(o,e)):Te(o,'filter',e.fn,[L({fn:$})])},o.filterMap=R(a,o),o.prepend=function(e){var r=n('* → '+o.shortName,{parent:D(o)}),t=Ne();return t&&S(r).seq.push(t.upward),ze(r,o,'prepend',e),je(o,r),r},Oe(o,o);var i=Ne();return i&&(S(o).meta.nativeTemplate=i),Se(o)}function a(e,r){return Te(e,'filterMap',r,[J({fn:$}),G.defined()])}function o(e,r){function n(e,r){c.off(e),C(c).set(e,xe(Pe(e,c,'on',1,r)))}var a,i=W(e),u=W(e),f=De('updates'),s=Ne();i.after=[{type:'copy',to:u}],s&&s.plain.push(i);var c=((a={subscribers:new Map,updates:f,defaultState:e,stateRef:i,getState:function(){var e=ve();return X(e&&e.reg[i.id]?e.reg[i.id]:i)},setState:function(e){he({target:c,params:e,defer:1})},reset:function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];for(var n=0,a=r;n<a.length;n++){var o=a[n];c.on(o,(function(){return c.defaultState}))}return c},on:function(e,r){if(Array.isArray(e)){var t=e,a=Array.isArray(t),o=0;for(t=a?t:t[Symbol.iterator]();;){var i;if(a){if(o>=t.length)break;i=t[o++]}else{if((o=t.next()).done)break;i=o.value}n(i,r)}}else n(e,r);return c},off:function(e){var r=C(c).get(e);return r&&(r(),C(c).delete(e)),c},map:function(e,r){var t,n,a;k(e)&&(t=e,n=e.name,r=e.firstState,e=e.fn);var u=c.getState(),f=Ne();f?a=null:void 0!==u&&(a=e(u,r));var s=o(a,{name:T(c,n),config:t,strict:0}),l=Pe(c,s,'map',0,e);return _(s).before=[{type:'map',fn:e,from:i}],f&&(f.plain.includes(i)||l.seq.includes(f.loader)||l.seq.unshift(f.loader)),s}})[l]=function(){return Oe(c,{})},a);return c.graphite=t({scope:{state:i},node:[G.defined(),U({store:i}),G.changed({store:u}),U({store:u})],child:f,meta:Ce('store',c,r)}),ue&&void 0===e&&b("current state can't be undefined, use null instead"),s&&(S(c).meta.nativeTemplate=s),c.watch=c.subscribe=function(e,r){if(!r||!p(e)){w(e)||b('watch requires function handler');var t=Ne();return t?t.watch.push({of:i,fn:e}):e(c.getState()),Ee(c,e)}return w(r)||b('second argument should be a function'),e.watch((function(e){return r(c.getState(),e)}))},ee(c,[f]),Se(c)}function i(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n,a,o;0===r.length&&b('at least one argument required'),E(r[0])&&(o=A(r[0]),r=E(r[0]));var i,u,f=r[r.length-1];if(w(f)?(a=r.slice(0,-1),n=f):a=r,1===a.length){var s=a[0];m(s)||(i=s,u=1)}return u||(i=a,n&&(n=Re(n))),Ie(Array.isArray(i),i,o,n)}function u(e,r){var i=n(e,r),u=i.defaultConfig.handler||function(){return console.error("no handler used in "+i.getType()),Promise.resolve()};S(i).meta.onCopy=['runner'],S(i).meta.unit=i.kind='effect',i.use=function(e){return u=e,i};var f=i.finally=De('finally'),s=i.done=a(f,{named:'done',fn:function(e){if('done'===e.status)return{params:e.params,result:e.result}}}),c=i.fail=a(f,{named:'fail',fn:function(e){if('fail'===e.status)return{params:e.params,error:e.error}}}),l=i.doneData=s.map({named:'doneData',fn:function(e){return e.result}}),p=i.failData=c.map({named:'failData',fn:function(e){return e.error}}),d=t({scope:{getHandler:i.use.getCurrent=function(){return u},finally:f},node:[Q({fn:function(e,r,t){var n,a=e.params,o=e.req,i=r.finally,u=r.getHandler,f=t.page,s=Fe({params:a,req:o,ok:1,anyway:i,page:f}),c=Fe({params:a,req:o,ok:0,anyway:i,page:f});try{n=u()(a)}catch(l){return void c(l)}k(n)&&w(n.then)?n.then(s,c):s(n)}})],meta:{op:'fx',fx:'runner',onCopy:['finally']}});S(i).scope.runner=d,S(i).seq.push(J({fn:function(e,r,t){return D(t)?{params:e,req:{rs:function(){},rj:function(){}}}:e}}),Q({fn:function(e,r){return he({target:r.runner,params:e,defer:1}),e.params}})),i.create=function(e){var r,t=((r={}).req=new Promise((function(e,t){r.rs=e,r.rj=t})),r.req.catch((function(){})),r);return he(i,{params:e,req:t}),t.req};var m=i.inFlight=o(0,{named:'inFlight'}).on(i,(function(e){return e+1})).on(f,(function(e){return e-1})),v=i.pending=m.map({fn:function(e){return e>0},named:'pending'});return ee(i,[f,s,c,l,p,v,m,d]),i}function f(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var i,u,f;E(r[0])&&(f=A(r[0]),r=E(r[0]));var s=r,c=s[0],l=s[1],d=s[2],v=s[3],h=void 0===v?0:v;void 0===l&&'source'in c&&('clock'in c&&null==c.clock&&b('config.clock should be defined'),l=c.clock,d=c.fn,h=c.greedy,i=c.target,u=c.name,c=c.source),void 0===l&&(l=c),u=f||u||c.shortName,c=Be(c),l=Be(l),'boolean'==typeof d&&(h=d,d=null);var g=Ne(),y=!!i;if(!i)if(m(c)&&m(l)){var k=d?d(X(_(c)),X(_(l))):X(_(c));i=o(k,{name:u})}else i=n(u),g&&S(i).seq.push(g.loader);var w=y&&p(i)&&S(i).meta.nativeTemplate;if(m(c))ee(c,[_e(l,i,{scope:{fn:d,targetTemplate:w},node:[g&&g.loader,!h&&K({priority:'sampler'}),B({store:_(c),to:d?'a':'stack'}),d&&J({fn:Z}),g&&y&&g.upward],meta:{op:'sample',sample:'store'}})]);else{var x=W(0),q=W(),N=W();g&&g.plain.push(x,q,N),Se(t({parent:c,node:[U({store:q}),B({from:'value',store:1,target:x})],family:{owners:[c,i,l],links:i},meta:{op:'sample',sample:'source'}})),ee(c,[_e(l,i,{scope:{fn:d,targetTemplate:w},node:[g&&g.loader,U({store:N}),B({store:x}),L({fn:function(e){return e}}),!h&&K({priority:'sampler'}),B({store:q}),B({store:N,to:'a'}),d&&J({fn:Y}),g&&y&&g.upward],meta:{op:'sample',sample:'clock'}})])}return i}function s(e,r,t){if(m(e))return e;if(p(e)){var n,a=D(e);return v(e)&&(n=o(r,{parent:a,name:e.shortName,"ɔ":t}).on(e,(function(e,r){return r}))),h(e)&&(n=o(r,{parent:a,name:e.shortName,"ɔ":t}).on(e.done,(function(e,r){return r.result}))),a&&a.hooks.store(n),n}var i={};return Me(e,(function(e,r){i[r]=m(e)?e:o(e,{name:r})})),i}Object.defineProperty(exports,'__esModule',{value:1});for(var c,l=((c=require('symbol-observable'))&&'object'==typeof c&&'default'in c?c.default:c),p=function(e){return(w(e)||k(e))&&'kind'in e},d=function(e){return function(r){return p(r)&&r.kind===e}},m=d("store"),v=d("event"),h=d("effect"),g=d("domain"),y={__proto__:null,unit:p,store:m,event:v,effect:h,domain:g},b=function(e){throw Error(e)},k=function(e){return'object'==typeof e&&null!==e},w=function(e){return'function'==typeof e},x=function(e){k(e)||w(e)||b('expect value to be an object')},S=function(e){return e.graphite||e},q=function(e){return e.family.owners},N=function(e){return e.family.links},_=function(e){return e.stateRef},A=function(e){return e.config},E=function(e){return e.ɔ},j=function(e){return e.value},C=function(e){return e.subscribers},D=function(e){return e.parent},z=function(e,r){return''+e.shortName+r},T=function(e,r){return null==r?z(e,' → *'):r},O=function(){var e=0;return function(){return(++e).toString(36)}},P=O(),M=O(),R=function(e,r){return e.bind(null,r)},I=function(e,r,t){return e.bind(null,r,t)},F=function(e,r,t){return{id:M(),type:e,data:t,hasRef:r}},H=0,K=function(e){var r=e.priority;return F('barrier',0,{barrierID:++H,priority:void 0===r?'barrier':r})},B=function(e){var r=e.from,t=void 0===r?'store':r,n=e.target,a=e.to;return F('mov','store'===t,{from:t,store:e.store,to:void 0===a?n?'store':'stack':a,target:n})},G={defined:function(){return F('check',0,{type:'defined'})},changed:function(e){return F('check',1,{type:'changed',store:e.store})}},J=I(F,'compute',0),L=I(F,'filter',0),Q=I(F,'run',0),U=function(e){return B({from:'stack',target:e.store})},V={__proto__:null,barrier:K,mov:B,check:G,compute:J,filter:L,run:Q,update:U},W=function(e){return{id:M(),current:e}},X=function(e){return e.current},Y=function(e,r,t){return(0,r.fn)(e,t.a)},Z=function(e,r,t){return(0,r.fn)(t.a,e)},$=function(e,r){return(0,r.fn)(e)},ee=function(e,r){for(var t=S(e),n=0;n<r.length;n++){var a=S(r[n]);'domain'!==t.family.type&&(a.family.type='crosslink'),q(a).push(t),N(t).push(a)}},re=function(e){void 0===e&&(e=[]);var r=[];if(Array.isArray(e))for(var t=0;t<e.length;t++)Array.isArray(e[t])?r.push.apply(r,e[t]):r.push(e[t]);else r.push(e);return r.map(S)},te=function(e,r){var t,n=e.type,a=e.data;e.hasRef&&(r[(t=a.store).id]=t),'mov'===n&&'store'===a.to&&(r[(t=a.target).id]=t)},ne=null,ae=function e(r,t){if(!r)return t;if(!t)return r;var n,a=r.v.type===t.v.type;return(a&&r.v.id>t.v.id||!a&&'sampler'===r.v.type)&&(n=r,r=t,t=n),n=e(r.r,t),r.r=r.l,r.l=n,r},oe=[],ie=0;ie<5;)oe.push({first:null,last:null,size:0}),ie+=1;var ue,fe=function(){for(var e=0;e<5;e++){var r=oe[e];if(r.size>0){if(2===e||3===e){r.size-=1;var t=ne.v;return ne=ae(ne.l,ne.r),t}1===r.size&&(r.last=null);var n=r.first;return r.first=n.r,r.size-=1,n.v}}},se=function(e,r,t,n,a){return ce(0,{a:null,b:null,node:t,parent:n,value:a,page:r},e)},ce=function(e,r,t,n){void 0===n&&(n=0);var a=le(t),o=oe[a],i={v:{idx:e,stack:r,type:t,id:n},l:0,r:0};2===a||3===a?ne=ae(ne,i):(0===o.size?o.first=i:o.last.r=i,o.last=i),o.size+=1},le=function(e){switch(e){case'child':return 0;case'pure':return 1;case'barrier':return 2;case'sampler':return 3;case'effect':return 4;default:return-1}},pe=new Set,de=0,me=null,ve=function(){return me},he=function(e,r,t){var n=me,a=null;if(e.target&&(r=e.params,t=e.defer,n='page'in e?e.page:n,e.stack&&(a=e.stack),e=e.target),Array.isArray(e))for(var o=0;o<e.length;o++)se('pure',n,S(e[o]),a,r[o]);else se('pure',n,S(e),a,r);t&&de||function(){var e,r,t,n,a,o,i={alreadyStarted:de,currentPage:me};de=1;e:for(;n=fe();){var u=n.idx,f=n.stack,s=n.type;t=f.node,me=a=f.page,o=(a||t).reg;var c={fail:0,scope:t.scope};e=r=0;for(var l=u;l<t.seq.length&&!e;l++){var p=t.seq[l],d=p.data;switch(p.type){case'barrier':var m=d.barrierID;a&&(m=a.fullID+"_"+m);var v=d.priority;if(l!==u||s!==v){pe.has(m)||(pe.add(m),ce(l,f,v,m));continue e}pe.delete(m);break;case'mov':var h=void 0;switch(d.from){case'stack':h=j(f);break;case'a':h=f.a;break;case'b':h=f.b;break;case'value':h=d.store;break;case'store':o[d.store.id]||(f.page=a=null,o=t.reg),h=X(o[d.store.id])}switch(d.to){case'stack':f.value=h;break;case'a':f.a=h;break;case'b':f.b=h;break;case'store':o[d.target.id].current=h}break;case'check':switch(d.type){case'defined':r=void 0===j(f);break;case'changed':r=j(f)===X(o[d.store.id])}break;case'filter':r=!ge(c,d,f);break;case'run':if(l!==u||'effect'!==s){ce(l,f,'effect');continue e}case'compute':f.value=ge(c,d,f)}e=c.fail||r}if(!e)for(var g=0;g<t.next.length;g++)se('child',a,t.next[g],f,j(f))}de=i.alreadyStarted,me=i.currentPage}()},ge=function(e,r,t){var n=r.fn;try{return n(j(t),e.scope,t)}catch(a){console.error(a),e.fail=1}},ye=function(e,r){var t=e.indexOf(r);-1!==t&&e.splice(t,1)},be=function(e,r){ye(e.next,r),ye(q(e),r),ye(N(e),r)},ke=function(e){return e.clear()},we=function(e,r){var t=(void 0===r?{}:r).deep,n=0;if(e.ownerSet&&e.ownerSet.delete(e),m(e))ke(C(e));else if(g(e)){n=1;var a=e.history;ke(a.events),ke(a.effects),ke(a.stores),ke(a.domains)}(function e(r,t,n){var a;r.next.length=0,r.seq.length=0,r.scope=null;for(var o=N(r);a=o.pop();)be(a,r),(t||n&&!r.meta.sample||'crosslink'===a.family.type)&&e(a,t,n);for(o=q(r);a=o.pop();)be(a,r),n&&'crosslink'===a.family.type&&e(a,t,n)})(S(e),!!t,n)},xe=function(e){var r=I(we,e,void 0);return r.unsubscribe=r,r},Se=function(e){return qe&&ee(j(qe),[e]),e},qe=null,Ne=function(){return qe&&qe.template},_e=function(e,r,n){return Se(t({node:n.node,parent:e,child:r,scope:n.scope,meta:n.meta,family:{owners:[e,r],links:r}}))},Ae=function(e){var r;E(e)&&(r=A(e),e=E(e));var n=e.from,a=e.to,o=e.meta,i=void 0===o?{op:'forward'}:o;return n&&a||b('from and to fields should be defined'),r&&(i.config=r),xe(Se(t({parent:n,child:a,meta:i,family:{}})))},Ee=function(e,r){return xe(Se(t({scope:{fn:r},node:[Q({fn:$})],parent:e,meta:{op:'watch'},family:{owners:e}})))},je=function(e,r){D(e)&&D(e).hooks.event(r)},Ce=function(e,t,n,a){var o=function e(r,t){return k(r)&&(e(A(r),t),null!=r.name&&(k(r.name)?e(r.name,t):t.name=r.name),r.loc&&(t.loc=r.loc),r.sid&&(t.sid=r.sid),r.handler&&(t.handler=r.handler),D(r)&&(t.parent=D(r)),'strict'in r&&(t.strict=r.strict),r.named&&(t.named=r.named),e(E(r),t)),t}({name:a,config:n},{}),i=P(),u=o.parent,f=void 0===u?null:u,s=o.sid,c=void 0===s?null:s,l=o.strict,p=void 0===l?1:l,d=o.named,m=void 0===d?null:d,v=m||o.name||('domain'===e?'':i),h=r(v,f);return t.kind=e,t.id=i,t.sid=c,t.shortName=v,t.parent=f,t.compositeName=h,t.defaultConfig=o,t.thru=function(e){return e(t)},t.getType=function(){return h.fullName},ue=p,{unit:e,name:v,sid:c,named:m}},De=function(e){return n({named:e})},ze=function(e,r,t,n){return _e(e,r,{scope:{fn:n},node:[J({fn:$})],meta:{op:t}})},Te=function(e,r,t,a){var o;k(t)&&(o=t,t=t.fn);var i=n(z(e,' →? *'),o);return _e(e,i,{scope:{fn:t},node:a,meta:{op:r}}),i},Oe=function(e,r){return r.subscribe=function(r){return x(r),e.watch((function(e){r.next&&r.next(e)}))},r[l]=function(){return r},r},Pe=function(e,r,t,n,a){var o=_(r),i=[B({store:o,to:'a'}),J({fn:n?Z:Y}),G.defined(),G.changed({store:o}),U({store:o})],u=Ne();if(u&&(i.unshift(u.loader),m(e))){var f=_(e);u.plain.includes(f)||(u.closure.includes(f)||u.closure.push(f),o.before||(o.before=[]),o.before.push({type:'closure',of:f}))}return _e(e,r,{scope:{fn:a},node:i,meta:{op:t}})},Me=function(e,r){for(var t in e)r(e[t],t)},Re=function(e){return function(r){return e.apply(void 0,r)}},Ie=function(r,t,n,a){var i=r?function(e){return e.slice()}:function(e){return Object.assign({},e)},u=r?[]:{},f=Ne(),s=i(u),c=W(s),l=W(1);c.type=r?'list':'shape',f&&f.plain.push(c,l);var p=o(s,{name:n||e(t)}),d=[G.defined(),B({store:c,to:'a'}),L({fn:function(e,r,t){return e!==t.a[r.key]}}),B({store:l,to:'b'}),J({fn:function(e,r,t){var n=r.key;t.b&&(t.a=(0,r.clone)(t.a)),t.a[n]=e}}),B({from:'a',target:c}),B({from:'value',store:0,target:l}),K({priority:'barrier'}),B({from:'value',store:1,target:l}),B({store:c}),a&&J({fn:a}),G.changed({store:_(p)})],v=c.before=[];return Me(t,(function(e,r){if(m(e)){u[r]=e.defaultState,s[r]=e.getState();var t=_e(e,p,{scope:{key:r,clone:i},node:d,meta:{op:'combine'}}),n=_(e);v.push({type:'field',field:r,from:n}),f&&(f.plain.includes(n)||t.seq.unshift(f.loader))}else s[r]=u[r]=e})),p.defaultShape=t,c.after=[a?{type:'map',to:_(p),fn:a}:{type:'copy',to:_(p)}],f||(p.defaultState=a?_(p).current=a(s):u),p},Fe=function(e){var r=e.params,t=e.req,n=e.ok,a=e.anyway,o=e.page;return function(e){return he({target:[a,He],params:[n?{status:'done',params:r,result:e}:{status:'fail',params:r,error:e},{fn:n?t.rs:t.rj,value:e}],defer:1,page:o})}},He=t({node:[Q({fn:function(e){(0,e.fn)(e.value)}})],meta:{op:'fx',fx:'sidechain'}}),Ke=function(e,r,t){return e.watch((function(e){ee(t,[e]),r.add(e),e.ownerSet||(e.ownerSet=r),D(e)||(e.parent=t)})),ee(t,[e]),function(t){return r.forEach(t),e.watch(t)}},Be=function(e){return p(e)?e:i(e)},Ge={__proto__:null,filterChanged:L({fn:function(e,r){return void 0!==e&&e!==X(r.state)}}),noop:J({fn:function(e){return e}})};exports.Kind={__proto__:null,store:"store",event:"event",effect:"effect",domain:"domain"},exports.attach=function(e){var r,t,n=e.source,a=e.effect,o=e.mapParams,f=u(),s=S(f).scope.runner,c=function(e,r,t){var n=e.params,a=e.req,i=r.finally,u=t.page;return he({target:r.effect,params:{params:o(n,t.a),req:{rs:Fe({params:n,req:a,ok:1,anyway:i,page:u}),rj:Fe({params:n,req:a,ok:0,anyway:i,page:u})}},page:u,defer:1})};if(n){var l;m(n)?l=n:(l=i(n),ee(f,[l]));var p=B({from:'store',store:_(l),to:'a'});t=[Q({fn:function(e){return e}}),p,J({fn:c})],te(p,s.reg)}else t=[Q({fn:c})];return s.scope.effect=a,s.meta.onCopy.push('effect'),(r=s.seq).splice.apply(r,[0,1].concat(t)),je(a,f),f},exports.blocks=Ge,exports.clearNode=we,exports.combine=i,exports.createApi=function(e,r){var t={};return Me(r,(function(r,a){var o=t[a]=n(a,{parent:D(e)});e.on(o,r),je(e,o)})),t},exports.createDomain=function e(r,a){var i=new Set,f=new Set,s=new Set,c=new Set,l=t({family:{type:'domain'}}),p={history:{domains:i,stores:f,effects:s,events:c},graphite:l};l.meta=Ce('domain',p,a,r);var d=['onEvent','onEffect','onStore','onDomain'].map(De),m=d[0],v=d[1],h=d[2],g=d[3];p.hooks={event:m,effect:v,store:h,domain:g},p.onCreateEvent=Ke(m,c,p),p.onCreateEffect=Ke(v,s,p),p.onCreateStore=Ke(h,f,p),p.onCreateDomain=Ke(g,i,p),p.createEvent=p.event=function(e,r){return m(n(e,{parent:p,config:r}))},p.createEffect=p.effect=function(e,r){return v(u(e,{parent:p,config:r}))},p.createDomain=p.domain=function(r,t){return e({name:r,parent:p,config:t})},p.createStore=p.store=function(e,r){return h(o(e,{parent:p,config:r}))},Se(p);var y=D(p);return y&&(Me(p.hooks,(function(e,r){Ae({from:e,to:y.hooks[r]})})),y.hooks.domain(p)),p},exports.createEffect=u,exports.createEvent=n,exports.createNode=t,exports.createStore=o,exports.createStoreObject=i,exports.forward=Ae,exports.fromObservable=function(e){x(e);var r=l in e?e[l]():e;r.subscribe||b('expect observable to have .subscribe');var t=n(),a=I(we,t,void 0);return r.subscribe({next:t,error:a,complete:a}),t},exports.guard=function(e,r){var a={op:'guard'};if(E(e)){a.config=A(e);var o=E(e);e=o[0],r=o[1]}r||(e=(r=e).source);var u=r.filter,s=r.greedy,c=r.name,l=void 0===c?'guard':c,d=r.target||n(l);return p(e)||(e=i(e)),p(u)?f({source:u,clock:e,target:Se(t({node:[L({fn:function(e){return e.guard}}),J({fn:function(e){return e.data}})],child:d,meta:a,family:{owners:[e,u,d],links:d}})),fn:function(e,r){return{guard:e,data:r}},greedy:s,name:l}):(w(u)||b('`filter` should be function or unit'),_e(e,d,{scope:{fn:u},node:[L({fn:$})],meta:a})),d},exports.is=y,exports.launch=he,exports.merge=function(r){var t=n(e(r,'merge'));return Ae({from:r,to:t,meta:{op:'merge'}}),t},exports.restore=s,exports.restoreEffect=s,exports.restoreEvent=s,exports.restoreObject=s,exports.sample=f,exports.setStoreName=function(e,t){var n=r(t,D(e));if(e.shortName=t,e.compositeName){var a=e.compositeName;a.path=n.path,a.shortName=n.shortName,a.fullName=n.fullName}else e.compositeName=n},exports.split=function(e,r){var t={},n=m(e)?e.updates:e;return Me(r,(function(e,r){t[r]=n.filter({fn:e}),n=n.filter({fn:function(r){return!e(r)}})})),t.__=n,t},exports.step=V,exports.version="20.15.0",exports.withRegion=function(e,r){qe={parent:qe,value:e,template:S(e).meta.template||qe&&qe.template};try{return r()}finally{qe=D(qe)}};
//# sourceMappingURL=compat.js.map
